var vmaxAdaptor=function(){var timestamp=Date.now()||(new Date).getTime(),playerAdsContainerId="player_ads_"+timestamp,playerAdsContainer=!1,insVideosContainerId="ins_videos_container_"+timestamp,CONST={pre:"0",post:"-1"},state={player:!1,playerContainer:!1,_adsContainer:!1,eventManager:!1,ads:{},_adsMap:{},_adsMapOriginal:{},_timeMarkers:[],_timeMarkersShown:[],_adspotKeys:[],_isVideoEnded:!1,_currentAdInterval:!1,_currentAdCounter:!1,onAdBreakStart:function(){},onAdBreakComplete:function(){},onContentPause:function(){},onContentPlay:function(){},isPreRollAdShown:!0,isAdBreakPlaying:!1,isMac:/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),counterEventPlayFail:0,maxCounterEventPlayFail:5,timerEventPlayFail:!1,showTapToUnmuteButton:!0},player={_isEventMetadataLoaded:!1,_isAdPlaying:!1,play:function(){try{if(!state.hasOwnProperty("player")||!state.player)return;state.player.play(),setTimeout(state.player.play,100),state.isMac&&(state.player.currentTime=state.player.currentTime+1,state.player.currentTime=state.player.currentTime-1),player._isAdPlaying=!1}catch(err){console.error("Could not play the content!",err)}},pause:function(){try{if(!state.hasOwnProperty("player")||!state.player)return;state.player.pause(),player._isAdPlaying=!0}catch(err){console.error("Could not pause the content!",err)}},enterFullscreen:function(){try{state.playerContainer.requestFullscreen?state.playerContainer.requestFullscreen():state.playerContainer.mozRequestFullScreen?state.playerContainer.mozRequestFullScreen():state.playerContainer.webkitRequestFullscreen?state.playerContainer.webkitRequestFullscreen():state.playerContainer.msRequestFullscreen&&state.playerContainer.msRequestFullscreen()}catch(err){console.error("Could not enter fullscreen mode!")}},exitFullscreen:function(){try{document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitExitFullscreen?document.webkitExitFullscreen():document.msExitFullscreen&&document.msExitFullscreen()}catch(err){console.error("Could not exit fullscreen mode!")}}};return{showAds:function(options){if("undefined"==typeof VMAX)return void console.log("VMAX SDK is not defined!");try{if(!function(){try{const INSContainers=document.querySelectorAll(".___ins_ads_videos_container___");if(0===INSContainers.length)return!0;for(let i=INSContainers.length-1;i>=0;i--){const _insTags=INSContainers[i].querySelectorAll("ins");for(let i2=_insTags.length-1;i2>=0;i2--)_insTags[i2].parentNode.removeChild(_insTags[i2]),delete _insTags[i2];INSContainers[i].parentNode.removeChild(INSContainers[i]),delete INSContainers[i]}return!0}catch(err){return console.warn("Unable to remove INS container(s)!",err),!1}}())return;if(!destroyExistingAdBreaks())return;if(!resetState())return;var dummyFunction=function(){},reInitialize=options.hasOwnProperty("reInitialize")&&options.reInitialize;state.eventManager=options.eventManager,state.player=options.player,state.playerContainer=options.playerContainer,state.ads=function(ads){try{if("object"!=typeof ads||!ads instanceof Object)return{};var originalAdsObject=Object.assign({},ads||{}),adsObject={};if(originalAdsObject.hasOwnProperty("video_break")&&Object.keys(originalAdsObject.video_break).length>0&&(adsObject=Object.assign({},originalAdsObject.video_break)),originalAdsObject.hasOwnProperty("video_ads")&&Object.keys(originalAdsObject.video_ads).length>0)for(var cuePoint in originalAdsObject.video_ads)adsObject.hasOwnProperty(cuePoint)||(adsObject[cuePoint]=Object.assign({},originalAdsObject.video_ads[cuePoint]),adsObject[cuePoint].singleAdCall=!0);return adsObject}catch(err){return console.warn("Could not parse data successfully!",err),{}}}(options.ads),state.customData=function(adsObject){try{return"object"==typeof adsObject&&adsObject instanceof Object&&adsObject.hasOwnProperty("key_values")&&Object.keys(adsObject.key_values).length>0?adsObject.key_values:{}}catch(err){return{}}}(options.ads),state.onAdBreakStart=options.hasOwnProperty("onAdBreakStart")?options.onAdBreakStart:dummyFunction,state.onAdBreakComplete=options.hasOwnProperty("onAdBreakComplete")?options.onAdBreakComplete:dummyFunction,state.onContentPause=options.hasOwnProperty("onContentPause")?options.onContentPause:dummyFunction,state.onContentPlay=options.hasOwnProperty("onContentPlay")?options.onContentPlay:dummyFunction,state.onAdEnterFullscreen=!!options.hasOwnProperty("onAdEnterFullscreen")&&options.onAdEnterFullscreen,state.onAdExitFullscreen=!!options.hasOwnProperty("onAdExitFullscreen")&&options.onAdExitFullscreen,state._timeMarkers=removeValuesFromArray(Object.keys(state.ads)||[],[CONST.pre,CONST.post]),state.isPreRollAdShown=!0,state.isAdBreakPlaying=!1,function(){try{for(var cuePoint in state._adsMap={},state.ads){var isValidCuePoint=!isNaN(cuePoint)&&cuePoint%1==0;if(isValidCuePoint){var adBreak=state.ads[cuePoint],singleAdCall=adBreak.singleAdCall||!1,breakArguments=singleAdCall?_videoAdsArguments(adBreak):_videoBreakArguments(adBreak,cuePoint);state._adsMap[cuePoint]={},console.log(breakArguments),state._adsMap[cuePoint]._adBreak=new VmaxAdBreak(breakArguments.placementIds),state._adsMap[cuePoint]._adBreak.setAdbreakvalues({breakArguments:breakArguments,playerAdsContainer:playerAdsContainer,customData:state.customData||{}}),state._adsMap[cuePoint]._adBreak.sort(function(arr){var data=arr,res=data.sort(function(a,b){return void 0===a.adInfo||a.adnetwork||void 0===a.adInfo.ad["playback-duration"]?1:void 0===b.adInfo||b.adnetwork||void 0===b.adInfo.ad["playback-duration"]?-1:a.adInfo.ad["playback-duration"]===b.adInfo.ad["playback-duration"]?0:a.adInfo.ad["playback-duration"]<b.adInfo.ad["playback-duration"]?-1:1});return res}),state._adsMap[cuePoint]._adBreak.resumeContent(function(){state.player.ended||(state.isPreRollAdShown=!0,state.isAdBreakPlaying=!1,player.play(),setTimeout(player.play,110),state.hasOwnProperty("onContentPlay")&&"function"==typeof state.onContentPlay&&state.onContentPlay())}),state._adsMap[cuePoint]._adBreak.playerPlay(function(){player.play(),setTimeout(player.play,110)}),state._adsMap[cuePoint]._adBreak.exitFullScreen(function(){state.onAdExitFullscreen&&"function"==typeof state.onAdExitFullscreen?state.onAdExitFullscreen():state.player.exitFullscreen()}),state._adsMap[cuePoint]._adBreak.enableFullscreen(function(){state.onAdEnterFullscreen&&"function"==typeof state.onAdEnterFullscreen?state.onAdEnterFullscreen():state.player.enterFullscreen()}),state._adsMap[cuePoint]._adBreak.isFullscreen(function(){state.player.isFullscreen()})}}return!0}catch(err){return console.error("Could not create ads map!",err),!1}}()&&function(reInitialize){if(!function(reInitialize){try{if(!0===reInitialize)return!0;(playerAdsContainer=document.createElement("div")).id=playerAdsContainerId;var insVideosContainerTemp=document.createElement("div");insVideosContainerTemp.id=insVideosContainerId;var styleAdsContainer=document.createElement("style");styleAdsContainer.type="text/css";var styleCss=document.createTextNode("#"+playerAdsContainerId+"{ position: absolute; top: 0px; left: 0; right: 0; bottom: 0; display: none; background: black;}#"+playerAdsContainerId+".active{ display: block; z-index: 94;}#"+playerAdsContainerId+".loader{ display: block; z-index: 95; background: #000;}#"+playerAdsContainerId+".loader:after{ content:''; display: block; position: absolute; top: 50%; left: 50%; width: 40px; height: 40px; border: 4px solid rgb(147,0,183,1); border-radius: 50%; border-top-color: rgba(255, 255, 255, 0.001); animation: spin 0.6s ease-in-out infinite; -webkit-animation: spin 0.6s ease-in-out infinite; margin: -20px 0 0 -20px;} @keyframes spin { to { -webkit-transform: rotate(360deg); } } @-webkit-keyframes spin { to { -webkit-transform: rotate(360deg); }}");return styleAdsContainer.appendChild(styleCss),document.body.appendChild(styleAdsContainer),state.playerContainer.querySelector(".playkit-container").appendChild(playerAdsContainer),_adsContainer=playerAdsContainer,document.body.appendChild(insVideosContainerTemp),insVideosContainerTemp,playerAdsContainer.addEventListener("click",function(){document.activeElement!=document.body&&document.activeElement.blur()}),!0}catch(err){return console.error("Could not find the Kaltura container!",err),!1}}(reInitialize))return;(function(){VMAXSDK.getGlobalVPP=function(){return new Zee5BasicVPP},VMAXSDK.onAdClose=function(containerId,placementId){!function(options){var placementId=options.placementId,insTag=(options.isSkipped,document.getElementById(placementId));insTag&&state._adspotKeys.indexOf(insTag.dataset.adspotKey)>-1&&state._adsMap[state._currentAdInterval]._adBreak.playNext(options)}({containerId:containerId,placementId:placementId,isSkipped:!0})},VMAXSDK.onAdError=function(placementId,error){var insTag=document.getElementById(placementId);insTag&&"active"!=playerAdsContainer.className&&state._adspotKeys.indexOf(insTag.dataset.adspotKey)>-1&&(state._adsMap[state._currentAdInterval]._adBreak.playNext({placementId:placementId,error:error}),playerAdsContainer.className="")}})(),function(){state.isMac?state.eventManager.listen(state.player,state.player.Event.PLAYBACK_START,showAdBreakPreRoll.bind(this)):showAdBreakPreRoll();function showAdBreakPreRoll(){state.isAdBreakPlaying||(state._adsMap.hasOwnProperty(CONST.pre)&&-1===state._timeMarkersShown.indexOf(CONST.pre)?(state._currentAdInterval=CONST.pre,state.isPreRollAdShown=!1,player.pause(),setTimeout(player.pause,100),state.hasOwnProperty("onContentPause")&&"function"==typeof state.onContentPause&&state.onContentPause(),setParamsForCompanionBehavior(CONST.pre),state._adsMap[CONST.pre]._adBreak.start(playerAdsContainer),state._timeMarkersShown.push(CONST.pre)):state.isPreRollAdShown=!0)}state.eventManager.listen(state.player,state.player.Event.FIRST_PLAY,function(){console.log(">>>>> FIRST PLAY EVENT!!")}.bind(this)),state.eventManager.listen(state.player,state.player.Event.PLAY_FAILED,function(){console.log(">>>>> PLAY FAILED EVENT!!"),0!==state.counterEventPlayFail||state.player.hasUserInteracted||(console.log("Attempting to play content with mute status: false"),state.player.muted=!0,state.player.play(),state.counterEventPlayFail++)}.bind(this)),state.eventManager.listen(state.player,state.player.Event.PLAYING,function(){state.counterEventPlayFail=0,state.isPreRollAdShown||(player.pause(),state.isPreRollAdShown=!0),state.isAdBreakPlaying&&player.pause()}.bind(this)),state.eventManager.listen(state.player,state.player.Event.LOADED_METADATA,function(){player._isEventMetadataLoaded=!0,state._isVideoEnded=!1,state.isPreRollAdShown&&setTimeout(player.play,500)}.bind(this)),state.eventManager.listen(state.player,state.player.Event.TIME_UPDATE,function(){if(state.isAdBreakPlaying)return;if(state._isVideoEnded=!1,player._isEventMetadataLoaded&&state.player.currentTime<1)state._adsMap.hasOwnProperty(CONST.pre)&&showAdBreakPreRoll.apply(this);else{var nextBestAdDuration=getNextBestAdDuration({currentTime:Math.floor(state.player.currentTime),excludeMarkers:state._timeMarkersShown,markers:state._timeMarkers});!1!==nextBestAdDuration.durationSelected&&(player.pause(),setTimeout(player.pause,100),state.hasOwnProperty("onContentPause")&&"function"==typeof state.onContentPause&&state.onContentPause(),state._currentAdInterval=nextBestAdDuration.durationSelected,setParamsForCompanionBehavior(nextBestAdDuration.durationSelected),state._adsMap[nextBestAdDuration.durationSelected]._adBreak.start(playerAdsContainer),state._timeMarkersShown=state._timeMarkersShown.concat(nextBestAdDuration.allDurations))}}.bind(this)),state.eventManager.listen(state.player,state.player.Event.ENDED,function(){if(state.isAdBreakPlaying)return;state._isVideoEnded=!0,function(){try{state._adsMap=map(state._adsMap,function(adBreak){return(adBreak=map(adBreak,function(singleAd){return singleAd._isShown=!1,singleAd._isValid=!1,singleAd._isSkipped=!1,singleAd}))._isShown=!1,adBreak}),state._timeMarkersShown=[]}catch(err){return console.error("Could not reset ads map!",err),!1}}(),state._adsMap.hasOwnProperty(CONST.post)&&-1===state._timeMarkersShown.indexOf(CONST.post)&&(state._currentAdInterval=CONST.post,player.pause(),setTimeout(player.pause,100),state.hasOwnProperty("onContentPause")&&"function"==typeof state.onContentPause&&state.onContentPause(),setParamsForCompanionBehavior(CONST.post),state._adsMap[CONST.post]._adBreak.start(playerAdsContainer),state._timeMarkersShown.push(CONST.post))}.bind(this))}()}(reInitialize)}catch(err){return console.warn("Could not run ads!",err),!1}},stopAds:function(){try{VMAXSDK.onAdReady=function(){},VMAXSDK.onAdClose=function(){},VMAXSDK.onAdError=function(){},VMAXSDK.onAdMediaEnd=function(){},destroyExistingAdBreaks(),resetState(),playerAdsContainer&&(playerAdsContainer.className="")}catch(err){console.error("Cannot stop ads!",err)}},playContent:function(options){try{state.player=options.player,state.eventManager=options.eventManager,setTimeout(player.play,500),state.eventManager.listen(state.player,state.player.Event.LOADED_METADATA,function(){setTimeout(player.play,500)}.bind(this))}catch(err){console.error("Could not play content!")}},_getAdsContiner_:function(){return playerAdsContainer}};function destroyExistingAdBreaks(){try{if(0===Object.keys(state._adsMap).length)return!0;for(var Interval in console.log(">>>>> Previous Ad maps",state._adsMap),state._adsMap)state._adsMap[Interval]._adBreak.destroy();return!0}catch(err){return console.error("Cannot destroy all adbreaks!",err),!1}}function resetState(){try{return state={player:!1,playerContainer:!1,_adsContainer:!1,eventManager:!1,ads:{},_adsMap:{},_adsMapOriginal:{},_timeMarkers:[],_timeMarkersShown:[],_adspotKeys:[],_isVideoEnded:!1,_currentAdInterval:!1,_currentAdCounter:!1,onAdBreakStart:function(){},onAdBreakComplete:function(){},onContentPause:function(){},onContentPlay:function(){},isPreRollAdShown:!0,isAdBreakPlaying:!1,isMac:/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),counterEventPlayFail:0,maxCounterEventPlayFail:5,timerEventPlayFail:!1,showTapToUnmuteButton:!0},!0}catch(err){return console.error("Could not reset state!",err),!1}}function _videoAdsArguments(adBreakObject){console.log(`videoAdsArguments:${adBreakObject}`);var totalAdsInAdBreak=0,adBreakPlacements={},placementIds=[];for(var sequence in adBreakObject)if(!(isNaN(sequence)||sequence.indexOf(".")>-1)){var ad=adBreakObject[sequence],insTag=getDOMNode(ad.tag);totalAdsInAdBreak++,adBreakPlacements[ad.tagid]=ad.tag,state._adspotKeys.push(insTag.dataset.adspotKey),placementIds.push(ad.tagid)}return{primaryList:Object.assign({},adBreakPlacements),statePlayer:state.player,playerAdsContainerId:playerAdsContainerId,singleAdCall:!0,totalAdsInAdBreak:totalAdsInAdBreak,placementIds:placementIds}}function _videoBreakArguments(adObject,cuePoint){console.log(`adObject:${adObject}`);var requested_ads=adObject.hasOwnProperty("requested_ads")&&!isNaN(adObject.requested_ads)&&adObject.requested_ads%1==0&&adObject.requested_ads,totalAdsInAdBreak=requested_ads&&requested_ads>1?requested_ads:1,adBreakPlacements={placementId:adObject.tagid,companionLevel:"primary",meta:'{"cue-point":"'+cuePoint+'","pos":"{$}"}',adspotKey:adObject.adspot_key,requested_ads:totalAdsInAdBreak,allow_only_complete_ad:void 0!==adObject.allow_only_complete_ad&&adObject.allow_only_complete_ad,max_time:adObject.max_time,order_by_time_ascending:void 0!==adObject.order_by_time_ascending&&adObject.order_by_time_ascending,use_total_duration_for_complete_ad:void 0!==adObject.use_total_duration_for_complete_ad&&adObject.use_total_duration_for_complete_ad,expected_time:adObject.expected_time};state._adspotKeys.push(adObject.adspot_key),adObject.hasOwnProperty("pkgName")&&(adBreakPlacements.pkgName=adObject.pkgName);let placementIds=Array.apply(null,Array(requested_ads)).map(_=>adObject.tagid);return{primaryList:[adBreakPlacements],statePlayer:state.player,playerAdsContainerId:playerAdsContainerId,totalAdsInAdBreak:totalAdsInAdBreak,placementIds:placementIds}}function setParamsForCompanionBehavior(cuePoint){VMAXSDK.Companion.overrideParams={};var params,returnParams,videoAdBreak=state.ads.hasOwnProperty(cuePoint)&&state.ads[cuePoint],videoAdBreakCompanionParams=videoAdBreak&&videoAdBreak.hasOwnProperty("override_companion_params")&&videoAdBreak.override_companion_params;return videoAdBreakCompanionParams&&(setCompanionParams=(params=videoAdBreakCompanionParams,returnParams=Object.assign({},params),returnParams=(returnParams=JSON.stringify(returnParams)).replace(/show_delay/gim,"showDelay").replace(/close_delay/gim,"closeDelay").replace(/hide_on_endcard/gim,"hideOnEndcard"),returnParams=JSON.parse(returnParams)),Object.keys(setCompanionParams).length>0&&(VMAXSDK.Companion.overrideParams=Object.assign({},setCompanionParams))),!0}function getNextBestAdDuration(options){var currentTime=options.currentTime,excludeMarkers=options.excludeMarkers,markers,remainingMarkers,removeMarkersHigherThanCurrentTime=findAllFromArray(removeValuesFromArray(options.markers,excludeMarkers),function(duration){return parseInt(duration)<=currentTime},[]),allDurations=[].concat(removeMarkersHigherThanCurrentTime),durationSelected=removeMarkersHigherThanCurrentTime.shift()||false,adsIgnored=removeMarkersHigherThanCurrentTime.length>0?removeMarkersHigherThanCurrentTime:false;return{durationSelected:durationSelected,adsIgnored:adsIgnored,allDurations:allDurations}}function map(_object,_callback){try{for(var _key in _object)_object[_key]=_callback(_object[_key],_key,_object);return _object}catch(err){return console.warn("Cannot iterate through the object",err),_object||[]}}function findAllFromArray(_array,_callback,_defaultReturnValue){try{_defaultReturnValue=_defaultReturnValue||[];var _tmpArray=[];for(var i=0;i<_array.length;i++){if(_callback(_array[i],i,_array)){_tmpArray.push(_array[i])}}return _tmpArray.length>0?_tmpArray:_defaultReturnValue}catch(err){console.warn("Could not find values from array!",err);return _array||[]}}function removeValuesFromArray(_array,_arrayOfValuesToRemove){try{if(0===_arrayOfValuesToRemove.length)return _array;_tmpArray=[].concat(_array),_arrayOfValuesToRemove=_arrayOfValuesToRemove||[];for(var i=_tmpArray.length;i>=0;i--)_arrayOfValuesToRemove.indexOf(_tmpArray[i])>-1&&_tmpArray.splice(i,1);return _tmpArray}catch(err){return console.warn("Could not remove values from array!",err),_array||[]}}}();function getDOMNode(htmlString){return(new DOMParser).parseFromString(htmlString,"text/html").getElementsByTagName("ins")[0]||null}function mapAdBreakTags(_object,_callback){try{for(var _key in _object)_object[_key].hasOwnProperty("tag")&&_object[_key].tag&&(_object[_key]=_callback(_object[_key],_key,_object));return _object}catch(err){return console.warn("Cannot iterate through the object",err),_object||[]}}